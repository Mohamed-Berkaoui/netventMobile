# AI Match Calculation - Edge Function Setup Guide---


















































































































































































































































































5. (Optional) Customize matching algorithm4. (Optional) Set up scheduled automation3. ✅ View results in app2. ✅ Test with `trigger-match-calculation.ts`1. ✅ Deploy the Edge Function## Next Steps---```if (matchAB.score >= 50) {  // was 40// Change score thresholdcomplementaryRoles.consultant = ["founder", "cto", "developer"];// Add new complementary rolesconst interestScore = Math.min(commonInterests.length * 20, 80);// Increase interest points```typescriptTo adjust the matching algorithm, edit `/supabase/functions/calculate-matches/index.ts`:## Customization---```}  "message": "Created matches for 12 connections"  "attendeesProcessed": 5,  "matchesCreated": 12,  "success": true,{```json## API Response Format---Make sure you're using the **Service Role Key** (not anon key) for the Edge Function.### "Service role key not found"```);  WHERE event_id = 'your-event-id'  SELECT user_id FROM registrations WHERE id IN (FROM users SELECT id, name, interests, company, position -- Check user profilesWHERE event_id = 'your-event-id' AND status = 'registered';FROM registrations SELECT COUNT(*) as user_count -- Debug query```sql4. Score threshold is ≥ 403. Users have profiles (name, interests, company, position)2. Users registered for the event1. Event exists in databaseCheck:### No Matches Created```# Or check Supabase Dashboard → Functions → calculate-matches → Logssupabase functions download calculate-matches --name calculate-matchessupabase functions list# Check logs```bash### Function Returns 500 Error## Troubleshooting---```SUPABASE_SERVICE_ROLE_KEY=your-service-role-keySUPABASE_URL=https://your-project.supabase.co```bashMake sure these are set in your Supabase project:## Environment Variables---```);  )'    ''Bearer your-service-role-key''    ''application/json'',    json_build_object(''eventId'', ''all''),    ''https://your-project.supabase.co/functions/v1/calculate-matches'',  'SELECT http_post(  '0 2 * * *',  -- 2 AM daily  'calculate-matches-daily',SELECT cron.schedule(-- Schedule matches calculation daily at 2 AMCREATE EXTENSION IF NOT EXISTS pg_cron;-- Enable pg_cron extension```sql### Option B: Scheduled Job (Using Cron Extension)```EXECUTE FUNCTION send_event_to_webhook();FOR EACH ROWAFTER INSERT ON registrationsCREATE TRIGGER webhook_registration_trigger$$ LANGUAGE plpgsql;END;  RETURN NEW;  -- Webhook will be called with the event_id from new registrationBEGINRETURNS trigger AS $$CREATE OR REPLACE FUNCTION send_event_to_webhook()```sql3. Create a stored procedure to extract eventId:     ```     Content-Type: application/json     Authorization: Bearer your-service-role-key     ```   - **Headers**:   - **URL**: `https://your-project.supabase.co/functions/v1/calculate-matches`   - **Event**: INSERT on `registrations`2. Create new webhook:1. Go to Supabase Dashboard → Database → WebhooksUse Supabase Database Webhooks to trigger matches when someone registers:### Option A: Supabase Webhooks## Scheduling Automatic Calculation (Optional)---```ORDER BY am.score DESC;WHERE am.event_id = '4248d8b3-abae-4ff5-a61c-e0fd5e63fbf4'JOIN users u2 ON am.matched_user_id = u2.idJOIN users u1 ON am.user_id = u1.idFROM ai_matches am  u2.name as "To User"  u1.name as "From User",  am.reasons,  am.score,SELECT -- See all matches for an event```sql### Query Database Directly3. You'll see suggested connections with scores2. Scroll to **"AI-Powered Matches"** section1. Open the app and go to **Connections** tab### View AI Matches in App## Viewing Results---| **Total Score** | **75** | Match created ✅ || Complementary roles | 25 | Developer + Designer || Same company (TechCorp) | 20 | Both @ TechCorp || Shared interests: "product", "design" | 30 | 2 × 15 ||--------|--------|--------|| Factor | Points | Reason |**User A (Developer, TechCorp)** ↔ **User B (Designer, TechCorp)**### Example Score Breakdown```      └─ Marketer ↔ Developer      ├─ CTO ↔ Founder      ├─ Developer ↔ Designer      ├─ Investor ↔ Founder   └─ Examples:└─ Complementary Roles: 25 points├─ Same Company: 20 points├─ Shared Interests: 15 points per interest (max 60)Score Calculation:```typescript### Matching Algorithm## How It Works---5. Click "Execute"```{"eventId":"4248d8b3-abae-4ff5-a61c-e0fd5e63fbf4"}```json4. Enter payload:3. Go to "Execute" tab2. Click on `calculate-matches`1. Go to Supabase Dashboard → Functions**Option C: Using Supabase Dashboard**```  -d '{"eventId":"4248d8b3-abae-4ff5-a61c-e0fd5e63fbf4"}'  -H "Content-Type: application/json" \  -H "Authorization: Bearer eyJ..." \curl -X POST https://your-project.supabase.co/functions/v1/calculate-matches \```bash**Option B: Using curl**```npx ts-node scripts/trigger-match-calculation.ts 4248d8b3-abae-4ff5-a61c-e0fd5e63fbf4# Trigger matches for an eventchmod +x scripts/trigger-match-calculation.ts# Make the script executable```bash**Option A: Using the script (recommended)**### 4. **Test the Function**```✓ Function calculate-matches deployed successfully```You should see:```supabase functions deploy calculate-matches```bashFrom the project root directory:### 3. **Deploy the Edge Function**Get your project ref from [Supabase Dashboard](https://app.supabase.com) → Settings → General```supabase link --project-ref your-project-ref```bash### 2. **Link Your Supabase Project**```npm install -g supabase```bashEnsure you have the Supabase CLI installed:### 1. **Verify Supabase Project Setup**## Setup Steps---Only matches with a score ≥ 40 are stored.- **Complementary Positions** (25 points)- **Same Company** (20 points)- **Shared Interests** (15 points each, max 60)The `calculate-matches` Supabase Edge Function automatically calculates compatibility scores between event attendees based on:## OverviewnoteId: "af4ea310f6e711f0b5a95b580f396d1e"
tags: []

---

